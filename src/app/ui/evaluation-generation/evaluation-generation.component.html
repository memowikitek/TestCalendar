<mat-drawer-container class="example-container" [hasBackdrop]="true">
   <mat-drawer #drawer mode="over" position="end" class="box-sidenav">
      <form [formGroup]="cicloFilterForm">
         <p>Elegir parámetros</p>
         <ng-container>
            <mat-form-field appearance="outline">
               <mat-label>Campus</mat-label>
               <mat-select multiple formControlName="campus" (selectionChange)="onSelectionChange($event,'campus')">
                  <mat-option [value]="0" *ngIf="listaCampus" (click)="toggleAllSelection('campus')">Todos</mat-option>
                  <mat-option *ngFor="let row of listaCampus" [value]="row.nombre">{{row.nombre}}</mat-option>
               </mat-select>
            </mat-form-field>
         </ng-container>
         <ng-container>
            <mat-form-field appearance="outline">
               <mat-label>Área Responsable</mat-label>
               <mat-select multiple formControlName="areaResp" (selectionChange)="onSelectionChange($event,'areaResp')">
                  <mat-option [value]="0" *ngIf="listaAR" (click)="toggleAllSelection('areaResp')">Todos</mat-option>
                  <mat-option *ngFor="let row of listaAR" [value]="row.nombre">{{row.nombre}}</mat-option>
               </mat-select>
            </mat-form-field>
         </ng-container>
         <ng-container>
            <mat-form-field appearance="outline">
               <mat-label>Tipo de Resultado</mat-label>
               <mat-select multiple formControlName="tipo" (selectionChange)="onSelectionChange($event,'tipo')">
                  <mat-option [value]="0" *ngIf="listaTR" (click)="toggleAllSelection('tipo')">Todos</mat-option>
                  <mat-option *ngFor="let row of listaTR" [value]="row.id">{{row.nombre}}</mat-option>
               </mat-select>
            </mat-form-field>
         </ng-container>
         <ng-container>
            <mat-form-field appearance="outline">
               <mat-label>Nivel/Modalidad</mat-label>
               <mat-select multiple formControlName="nivelMod" (selectionChange)="onSelectionChange($event,'nivelMod')">
                  <mat-option [value]="0" (click)="toggleAllSelection('nivelMod')">Todos</mat-option>
                  <mat-option *ngFor="let row of listaNivel" [value]="row.clave">{{row.clave}}</mat-option>
               </mat-select>
            </mat-form-field>
         </ng-container>
         <ng-container>
            <mat-form-field appearance="outline">
               <mat-label>Estatus</mat-label>
               <mat-select multiple formControlName="estatus" (selectionChange)="onSelectionChange($event,'estatus')">
                  <mat-option [value]="0" (click)="toggleAllSelection('estatus')">Todos</mat-option>
                  <mat-option [value]="true">Activo</mat-option>
                  <mat-option [value]="false">Inactivo</mat-option>
               </mat-select>
            </mat-form-field>
         </ng-container>
         <div class="container-btn-params">
            <button type="button" mat-raised-button class="mat-secundary" (click)="drawer.toggle()">Cancelar</button>
            <button type="button" mat-raised-button color="primary" (click)="aplicarFiltro()">Aplicar</button>
         </div>
         <div class="text-center">
            <button type="button" mat-raised-button (click)="btnCleanFilters('all')">Limpiar Filtros</button>
         </div>
      </form>
   </mat-drawer>
   <mat-drawer-content>
      <div style="height: 88vh">
         <main [class]="'px-4 pb-4'">
            <div class="content p-0">
               <app-breadcrumbs></app-breadcrumbs>
               <div class="row mt-4 margin-head">
                  <div class="col-md-8">
                     <app-title-cycle-bar [nombre]="nombre" [proceso]="proceso"></app-title-cycle-bar>
                  </div>
                  <div class="col-md-4">
                     <app-bar-progress-bs *ngIf="fecIni && fecFin && hasIndictaros" [fecIni]="fecIni" [fecFin]="fecFin" [etapas]="etapas"></app-bar-progress-bs>
                  </div>
               </div>
               <div class="row margenes">
                  <div class="col-md-12">
                     <app-resumen-cycle-bar [title]="'Datos del ciclo'" [arrList]="cicloEva" [totalIndicadores]="registros" [bol]="!hasIndictaros"></app-resumen-cycle-bar>
                  </div>
                  <mat-divider></mat-divider>
                  <div class="col-md-12 p-0 mt-3 text-center" style="height: 560px;" *ngIf="!hasIndictaros">
                     <div class="d-flex justify-content-center mt-3">
                        <img src="./assets/img/EvaluacionAutoFont.png" alt="Laureate" />
                     </div>
                     <div class="col-12 p-0">
                        <p class="title-page mt-2 title-gray">Genera tu evaluación para visualizar los indicadores que formarán parte de este ciclo</p>
                     </div>
                     <div class="col-12 p-0">
                        <p class="title-page mt-2 title-gray">Una vez generada la evaluación, después del cruce de datos, podrás editar los indicadores en este ciclo sin afectar tus catálogos</p>
                     </div>
                     <div class="col-12 p-0">
                        <button type="button" mat-raised-button color="primary"  (click)="generarIndicadores()" class="btn-text mt-3 text-center" [hidden]="!checkPermission('E')">
                        Generar Evaluación
                        </button>
                     </div>
                  </div>
               </div>
               <div class="row mt-4" *ngIf="hasIndictaros">
                  <div class="col-lg-6 col-12">
                     <button type="button" mat-raised-button color="primary" class="btn-text mt-3 ms-3" (click)="getAllExcel()" [hidden]="!checkPermission('EX')">
                        <mat-icon>description</mat-icon>
                        Exportar Excel
                     </button>
                  </div>
                  <mat-form-field appearance="outline" class="col-lg-6 col-12 mt-1 pl-2">
                     <mat-label>Buscar por Campus, Área responsable, Clave del Indicador, Nombre del Indicador o Descripción del indicador</mat-label>
                     <!-- <input type="text" matInput #input appInputRestriction="APLHA_NUMERIC" name="busqueda" formControlName="busqueda" (keyup)="applyFilter($event)" /> -->
                     <input type="text" matInput [formControl]="searchControl" appInputRestriction="ALPHA_NUMERIC" name="busqueda" />
                  </mat-form-field>
               </div>
               <div class="row mt-2" *ngIf="hasIndictaros">
                  <div class="col-md-3"></div>
                  <div class="col-md-9 container-filters">
                     <span class="filtro-busqueda" matTooltip="" *ngIf="campus">Campus <span class="close" (click)="btnCleanFilters('campus')">x</span></span>
                     <span class="filtro-busqueda" matTooltip="" *ngIf="areaResp">Área responsable <span class="close" (click)="btnCleanFilters('areaResp')">x</span></span>
                     <span class="filtro-busqueda" matTooltip="" *ngIf="tipo">Tipo de Resultado <span class="close" (click)="btnCleanFilters('tipo')">x</span></span> 
                     <span class="filtro-busqueda" matTooltip="" *ngIf="nivelMod">Nivel/Modalidad <span class="close" (click)="btnCleanFilters('nivelMod')">x</span></span>  
                     <span class="filtro-busqueda" matTooltip="" *ngIf="estatus">Estatus <span class="close" (click)="btnCleanFilters('estatus')">x</span></span>       
                     <button id="btnParams" class="btnParams" mat-raised-button (click)="drawer.toggle()">Elegir parámetros</button>
                  </div>
               </div>
               <div class="row pb-4 mt-4"  *ngIf="hasIndictaros">
                  <div class="col-md-12 container__table mat-elevation-z8">
                     <table mat-table [dataSource]="dataSource" class="table mb-0">
                        <ng-container matColumnDef="nombreCampus">
                           <th mat-header-cell class="table__header table__cell-id" *matHeaderCellDef>Campus</th>
                           <td mat-cell class="table__cell table__cell-id" *matCellDef="let row">
                              {{ row.nombreCampus }}
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="area">
                           <th mat-header-cell class="table__header table__cell-id" *matHeaderCellDef>Área responsable</th>
                           <td mat-cell class="table__cell table__cell-id" *matCellDef="let row">
                              {{ row.nombreArea }}
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="indicadorTipoResultado">
                           <th mat-header-cell class="table__header table__cell-id" *matHeaderCellDef>Tipo de Resultado</th>
                           <td mat-cell class="table__cell table__cell-id" *matCellDef="let row">
                              {{ row.indicadorTipoResultado == 1 ? 'Nivel/Modalidad' : 'Común' }}
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="nivelModalidad">
                           <th mat-header-cell class="table__header table__cell-id" *matHeaderCellDef>Nivel/Modalidad</th>
                           <td mat-cell class="table__cell table__cell-id" *matCellDef="let row">
                              {{ row.nivelModalidad }}
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="claveIndicador">
                           <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Clave del Indicador</th>
                           <td mat-cell class="table__cell table__cell-name" *matCellDef="let row">
                              {{ row.claveIndicador }}
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="nombreIndicador">
                           <th mat-header-cell class="table__header table__cell-id" *matHeaderCellDef>Nombre del Indicador</th>
                           <td mat-cell class="table__cell table__cell-id" *matCellDef="let row">
                              {{ row.nombreIndicador }}
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="descripcionIndicador">
                           <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Descripción del indicador</th>
                           <td mat-cell class="table__cell table__cell-name" *matCellDef="let row">
                              {{ row.descripcionIndicador }}
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="metaInstitucional">
                           <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Meta Institucional</th>
                           <td mat-cell class="table__cell table__cell-name" *matCellDef="let row; let i = index">
                              <div class="metaDisplay">
                                 <span class="meta" *ngIf="!row.editingMeta" (click)="metaEdit(row)" matTooltip="Click para editar">{{ row.metaInstitucional }} <mat-icon *ngIf="!row.metaInstitucional" class="eye__icon">edit</mat-icon></span>
                                 <mat-form-field appearance="outline" *ngIf="row.editingMeta" style="width: 80px;">
                                    <input type="text" matInput class="metaInput-{{i}}" appInputRestriction="APLHA_NUMERIC" name="valorMeta" formControlName="valorMeta" [maxLength]="6" value="{{ row.metaInstitucional }}" />
                                 </mat-form-field>
                                 <span *ngIf="row.editingMeta">
                                    <mat-icon class="icon-acepted" (click)="metaUpdate(row.ceevaluacionId, i )">done</mat-icon>
                                    <mat-icon class="icon-closed" (click)="metaEditClose(row)">close</mat-icon>
                                 </span>
                              </div>
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="select">
                           <th mat-header-cell class="table__header table__cell--select" *matHeaderCellDef>
                              <div class="d-flex justify-content-center">Estatus</div>
                           </th>
                           <td mat-cell class="table__cell table__cell--select" *matCellDef="let row">
                              <div class="d-flex justify-content-center">
                                 <!--<mat-checkbox class="d-block" [checked]="row.activo" (click)="disableCorporateArea(row)">
                                    </mat-checkbox>-->
                                    <mat-slide-toggle class="ml-2" [checked]="row.activo"  (click)="disableCeEvaluacionByConfimation(row)" [disabled]="!checkPermission('E') || !row.activo"></mat-slide-toggle>  
                              </div>
                           </td>
                        </ng-container>
                        <ng-container matColumnDef="edit">
                           <th mat-header-cell *matHeaderCellDef> Acciones </th>
                           <td mat-cell class="table__cell table__cell--actions" *matCellDef="let element; let index = index">
                              <div class="d-flex justify-content-center">
                                 <button mat-button matTooltip="Ver" (click)="redirectViewIndicatorCE(element)">
                                 <!-- <button mat-button matTooltip="Ver" [hidden]="!checkPermission('C')"> -->
                                    <mat-icon class="eye__icon">remove_red_eye</mat-icon>
                                 </button>
                              </div>
                           </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="['nombreCampus', 'area', 'indicadorTipoResultado', 'nivelModalidad', 'claveIndicador', 'nombreIndicador', 'descripcionIndicador', 'metaInstitucional', 'select','edit']"></tr>
                        <tr mat-row *matRowDef="let row; columns: ['nombreCampus', 'area', 'indicadorTipoResultado', 'nivelModalidad', 'claveIndicador', 'nombreIndicador', 'descripcionIndicador', 'metaInstitucional', 'select', 'edit']">
                        </tr>
                     </table>
                     <ng-template>
                        <p class="empty-table mt-4">No hay datos para mostrar</p>
                     </ng-template>
                     <mat-paginator #paginator [length]="length" [pageIndex]="pageIndex" [pageSize]="pageSize"
                     [pageSizeOptions]="[25, 50, 75, 100]" class="ml-auto" showFirstLastButtons
                     (page)="paginatorChange($event)">
                     </mat-paginator>
                  </div>
               </div>
            </div>
         </main>
      </div>
   </mat-drawer-content>
</mat-drawer-container>