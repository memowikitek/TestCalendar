<form [formGroup]="form" autocomplete="off">
  <ng-container formArrayName="elementos">
    <div class="container">
      <div class="row">
        <div class="col-md-12 p-0">
          <h1 class="title-page mt-1">Captura de Metas</h1>
        </div>
      </div>
      <div class="row">
        <mat-dialog-content>
          <mat-accordion>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Resumen Captura de metas por indicador
                </mat-panel-title>
                <mat-icon>swap_vert</mat-icon>
              </mat-expansion-panel-header>
              <app-header-evaluation-configuration
                [configGeneralData]="configGeneralInfo"></app-header-evaluation-configuration>
              <!-- Complemento de campos -->
              <div class="container pt-2">
                <br>
                <div class="row">
                  <mat-form-field appearance="outline" class="col-md-3">
                    <mat-label>Region</mat-label>
                    <input matInput [readonly]="true" [value]="getRegionListHeader()">
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="col-md-3">
                    <mat-label>Campus</mat-label>
                    <input matInput [readonly]="true" [value]="getCampusListHeader()">
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="col-md-3">
                    <mat-label>Etapa</mat-label>
                    <input matInput [readonly]="true" [value]="dataRow.etapa">
                  </mat-form-field>
                </div>
                <div class="row">
                  <mat-form-field appearance="outline" class="col-md-3">
                    <mat-label>Fecha inicio</mat-label>
                    <input matInput [readonly]="true" [value]="dataRow.fechaInicio | date: 'dd/MM/yyyy'">
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="col-md-3">
                    <mat-label>Fecha fin</mat-label>
                    <input matInput [readonly]="true" [value]="dataRow.fechaFin | date: 'dd/MM/yyyy'">
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="col-md-3">
                    <mat-label>Avance captura metas</mat-label>
                    <input matInput [readonly]="true" [value]="dataRow.calculoAvance | number:'1.3-3'">
                  </mat-form-field>
                </div>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
          <br>
          <mat-divider></mat-divider>
          <div class="row pb-4">
            <div class="col-md-12 container__table mat-elevation-z8">
              <table mat-table [dataSource]="elementos.controls" class="table mb-0"
                *ngIf="elementos.controls.length > 0">

                <ng-container matColumnDef="componente">
                  <th mat-header-cell class="table__header table__cell-id" *matHeaderCellDef>Componente
                  </th>
                  <td mat-cell class="table__cell table__cell-id" *matCellDef="let row"
                    [title]="row.get('componente').value">
                    {{ row.get('claveComponente').value +" - " + row.get('componente').value }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="elementoEvaluacion">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Elemento de evaluación
                  </th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row"
                    [title]="row.get('elementoEvaluacion').value">
                    {{ row.get('claveElementoEvaluacion').value +" - " + row.get('elementoEvaluacion').value }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="indicator">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Indicador</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row"
                    [title]="row.get('indicadorSiac').value">
                    {{ row.get('claveIndicadorSiac').value +" - " + row.get('indicadorSiac').value }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="nivelModalidad">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Nivel / Modalidad</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row"
                    [title]="row.get('nivelModalidad').value">
                    {{ row.get('nivelModalidadId').value === 0 ? row.get('nivelModalidad').value :
                    row.get('nivelModalidadClave').value +" - " + row.get('nivelModalidad').value}}
                  </td>
                </ng-container>

                <ng-container matColumnDef="normativa">
                  <th mat-header-cell class="table__header table__cell-normativa" *matHeaderCellDef>Normativa</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row">
                    <button matTooltip="{{getNormativaList(row.get('normativas').value)}}" aria-label=""
                      style="width:120px; text-align: center;">
                      <mat-icon color="black">assignment</mat-icon>
                    </button>
                  </td>
                </ng-container>


                <ng-container matColumnDef="pmclcicloanterior">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>PM/CL ciclo anterior</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row"
                    [title]="row.get('cicloAnterior').value === 'SD' ? 'Sin dato' : row.get('cicloAnterior').value ">
                    {{ row.get('cicloAnterior').value}}
                  </td>
                </ng-container>

                <ng-container matColumnDef="metaanterior">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Meta Anterior</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row" [formGroup]="row">
                    <mat-form-field floatLabel="auto" style="width:120px; text-align: center;">
                      <input matInput type="number" placeholder="meta anterior" [readonly]="true"
                        formControlName="metaAnterior">
                    </mat-form-field>
                  </td>
                </ng-container>

                <ng-container matColumnDef="metaactual">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Meta Actual</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row" [formGroup]="row">
                    <mat-form-field floatLabel="auto" style="width:120px; text-align: center;" *ngIf="puedeCapturar">
                      <input matInput type="number" [min]="0" [max]="999999" pattern="/^-?\d+\.?\d*$/"
                        onKeyPress="if(this.value.length==6) return false;"
                        title="Si la meta no aplica para el indicador, deje el campo vacío y marque la casilla NA. Deberá explicarse en el campo de justificación"
                        [value]="row.get('noAplica').value == true ?? null" placeholder="meta actual"
                        [readonly]="row.get('noAplica').value  == true ? true : null" formControlName="metaActual">

                    </mat-form-field>
                    <mat-form-field floatLabel="auto" style="width:120px; text-align: center;" *ngIf="!puedeCapturar">
                      <input matInput type="number"
                        title="Si la meta no aplica para el indicador, deje el campo vacío y marque la casilla NA. Deberá explicarse en el campo de justificación"
                        readonly [value]="row.get('noAplica').value == true ?? null" placeholder="meta actual"
                        formControlName="metaActual">
                    </mat-form-field>

                  </td>
                </ng-container>

                <ng-container matColumnDef="checna">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Check de NA</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row" [formGroup]="row">
                    <mat-checkbox [disabled]="!puedeCapturar" formControlName="noAplica"
                      style="width:90px; text-align: center;">
                    </mat-checkbox>
                  </td>
                </ng-container>

                <ng-container matColumnDef="justificacionna">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Justificación</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row" [formGroup]="row">
                    <mat-form-field floatLabel="auto" style="width:120px; text-align: center;"
                      *ngIf="row.get('noAplica').value">
                      <input matInput type="text" placeholder="justificación"
                        title="Explique la razón por la cual no aplica la meta" formControlName="justificacionNa">
                    </mat-form-field>
                    <!-- <mat-checkbox formControlName="" style="width:90px; text-align: center;">
                    </mat-checkbox> -->
                  </td>
                </ng-container>

                <ng-container matColumnDef="autorizadona">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Autorizado NA</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row" [formGroup]="row">
                    <mat-checkbox formControlName="autorizadoNa" style="width:90px; text-align: center;"
                      [disabled]="!(row.get('noAplica').value && Autorizador)">
                    </mat-checkbox>
                  </td>
                </ng-container>

                <ng-container matColumnDef="consultaindicadormi">
                  <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Consulta Indicadores
                    Misión
                    Institucional</th>
                  <td mat-cell class="table__cell table__cell-name" *matCellDef="let row"
                    style="width:120px; text-align: center;">
                    <button type="button" mat-raised-button class="mt-3" (click)="onViewMi(row)" color="primary">
                      <mat-icon class="eye__icon">remove_red_eye</mat-icon>
                      Ver
                    </button>
                  </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="[ 'componente',
                'elementoEvaluacion',
                'indicator',
                'nivelModalidad',
                'normativa',
                'pmclcicloanterior',
                'metaanterior',
                'metaactual',
                'checna',
                'justificacionna',
                'autorizadona',
                'consultaindicadormi']"></tr>
                <tr mat-row *matRowDef="let row; columns: [ 'componente',
                'elementoEvaluacion',
                'indicator',
                'nivelModalidad',
                'normativa',
                'pmclcicloanterior',
                'metaanterior',
                'metaactual',
                'checna',
                'justificacionna',
                'autorizadona',
                'consultaindicadormi']"></tr>
              </table>
              <ng-template [ngIf]="elementos.controls.length === 0">
                <p class="empty-table mt-4">No hay datos para mostrar</p>
              </ng-template>
            </div>
          </div>
        </mat-dialog-content>
        <mat-dialog-actions align="center" class="pb-4" hidden="true">
          <button type="button" mat-raised-button class="mt-3" (click)="onUpdateConfiguration()" color="primary"
            [disabled]="!puedeCapturar">Aceptar</button>
          <button type="button" mat-raised-button class="mt-3" (click)="onClose()">Cancelar</button>
        </mat-dialog-actions>
      </div>
    </div>
  </ng-container>
</form>