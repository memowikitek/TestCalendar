<div class="container">
  <div class="row">
    <div class="col-md-12 p-0">
      <h1 class="title-page mt-1">Captura evidencias</h1>
    </div>
  </div>
  <div class="row">
    <mat-dialog-content class="ms-0" style="overflow: visible !important;">
      <app-header-evaluation-configuration [title]="'Captura de Evidencias por Indicador'"
        [configGeneralData]="dataRow"></app-header-evaluation-configuration>
      <br>
      <mat-divider></mat-divider>
      <div class="row pb-4">
        <div class="col-md-12 container__table mat-elevation-z8" style="overflow: scroll; height: 400px;">

          <table mat-table [dataSource]="listEvidenciasIndicadorCaptura" class="table mb-0" multiTemplateDataRows>

            <ng-container matColumnDef="estatus">
              <th mat-header-cell class="table__header table__cell-id" *matHeaderCellDef>Estatus
              </th>
              <td mat-cell class="table__cell table__cell-id" *matCellDef="let row">
                <span class="dot" style=" background-color: rgba(238, 37, 37, 0.678);"
                  *ngIf="getEstatusIndicador(row)==2"></span>
                <span class="dot" style=" background-color: rgba(0, 128, 0, 0.685);"
                  *ngIf="getEstatusIndicador(row)==1"></span>
                <!-- &nbsp;{{getEstatusIndicador(row)}} -->
              </td>
            </ng-container>

            <ng-container matColumnDef="componente">
              <th mat-header-cell class="table__header table__cell-id" *matHeaderCellDef>Componente
              </th>
              <td mat-cell class="table__cell table__cell-id" *matCellDef="let row" [title]="row.componenteNombre">
                {{ row.componenteClave +" - " + row.componenteNombre }}
              </td>
            </ng-container>

            <ng-container matColumnDef="elementoEvaluacion">
              <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Elemento de evaluación
              </th>
              <td mat-cell class="table__cell table__cell-name" *matCellDef="let row"
                [title]="row.elementoEvaluacionNombre">
                {{ row.elementoEvaluacionClave +" - " + row.elementoEvaluacionNombre }}
              </td>
            </ng-container>

            <ng-container matColumnDef="indicator">
              <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Indicador</th>
              <td mat-cell class="table__cell table__cell-name" *matCellDef="let row" [title]="getTitleIndicador(row)">
                {{ row.indicadorKpiclave +" - " + row.indicadorKpinombre }}
              </td>
            </ng-container>


            <ng-container matColumnDef="nivelmodalidad">
              <th mat-header-cell class="table__header table__cell-normativa" *matHeaderCellDef>Nivel/Modalidad</th>
              <td mat-cell class="table__cell table__cell-name" *matCellDef="let row" [title]="row.nivelModalidad">
                {{row.nivelModalidad}}
              </td>
            </ng-container>

            <ng-container matColumnDef="normativa">
              <th mat-header-cell class="table__header table__cell-normativa" *matHeaderCellDef>Normativa</th>
              <td mat-cell class="table__cell table__cell-name" *matCellDef="let row">
                <button matTooltip="{{getNormativaList(row.normativas)}}" aria-label="">
                  <mat-icon color="black">assignment</mat-icon>
                </button>
              </td>
            </ng-container>

            <ng-container matColumnDef="nombreevidencia">
              <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Evidencia&nbsp;&nbsp;</th>
              <td mat-cell class="table__cell table__cell-name" *matCellDef="let row">
                <button matTooltip="{{getEvidenciasList(row.formatoEvidencias)}}" matTooltipClass="tooltip-evidencias"
                  aria-label="">
                  <mat-icon color="black">assignment</mat-icon>
                </button>
              </td>
            </ng-container>

            <ng-container matColumnDef="subirevidencia">
              <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef> Carga de evidencias </th>
              <td mat-cell class="table__cell table__cell-name" *matCellDef="let row">
                <button type="button" mat-raised-button color="primary" style="margin-left: 2px;"
                  (click)="onChangeEvidenceFile(row)" [disabled]="!puedeCapturar">
                  <mat-icon>note_add</mat-icon>
                  Agregar
                </button>
                <button id="ver" type="button" mat-raised-button color="primary" style="margin-left: 2px">
                  <mat-icon id="ver" class="eye__icon">remove_red_eye</mat-icon>
                  Ver
                </button>
              </td>
            </ng-container>
            <!-- 
            <ng-container matColumnDef="autorizadona"> 
              <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Autorizado NA</th>
              <td mat-cell class="table__cell table__cell-name" *matCellDef="let row"
                style="width:150px; text-align: center;">
                <mat-checkbox style="width:90px; text-align: center;" [disabled]="true">
                </mat-checkbox>
              </td>
            </ng-container> -->

            <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
            <ng-container matColumnDef="expandedDetail">
              <td mat-cell *matCellDef="let element" [attr.colspan]="8">
                <div class="example-element-detail" *ngIf="element.evidenciasArchivos?.length"
                  [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                  <div class="inner-table mat-elevation-z8" *ngIf="expandedElement">

                    <table #innerTables mat-table [dataSource]="element.evidenciasArchivos">

                      <ng-container matColumnDef="estatus">
                        <th mat-header-cell *matHeaderCellDef> Estatus </th>
                        <td mat-cell *matCellDef="let element">
                          {{getEstatusText(element)}}
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="nombre">
                        <th mat-header-cell *matHeaderCellDef> Archivo </th>
                        <td mat-cell *matCellDef="let element" [title]="element.nombre"> {{element.nombre}} </td>
                      </ng-container>

                      <ng-container matColumnDef="justificacion">
                        <th mat-header-cell *matHeaderCellDef> Justificación </th>
                        <td mat-cell *matCellDef="let element" [title]="element.justificacion">
                          {{element.justificacion}} </td>
                      </ng-container>

                      <ng-container matColumnDef="actualizarestatus">
                        <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>
                          Aceptar/Rechazar
                        </th>
                        <td mat-cell *matCellDef="let row; let index = index" class="text-center">
                          &nbsp;&nbsp;
                          <button type="button" mat-raised-button color="primary"
                            (click)="getActualizaEstado(row,element,2)" [disabled]="(!row.estatus)">
                            <mat-icon>check_circle</mat-icon>
                          </button>
                          &nbsp;&nbsp;&nbsp;
                          <button type="button" mat-raised-button color="primary"
                            (click)="getActualizaEstado(row,element,3)" [disabled]="(!row.estatus)">
                            <mat-icon>cancel</mat-icon>
                          </button>
                          &nbsp;&nbsp;
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="acciones">
                        <th mat-header-cell class="table__header table__cell-name" *matHeaderCellDef>Acciones</th>
                        <td mat-cell *matCellDef="let row; let index = index" class="text-center">
                          <span *ngIf="!row.url">
                            &nbsp;&nbsp;
                            <button type="button" mat-raised-button color="primary" (click)="OnDownloadEvidence(row)"
                              [disabled]="(!row.estatus)">
                              <mat-icon>cloud_download</mat-icon>
                            </button>
                          </span>
                          <span *ngIf="row.url">
                            &nbsp;&nbsp;&nbsp;
                            <button type="button" class="mr-3" mat-raised-button color="primary"
                              (click)="OnOpenBrowser(row)">
                              <mat-icon>open_in_browser</mat-icon>
                            </button>
                          </span>
                          <span *ngIf="row.estatus!=2 || (visualizaCambioEstado || admin)">
                            &nbsp;&nbsp;&nbsp;
                            <button type="button" mat-raised-button color="primary"
                              (click)="OnDeleteEvidence(row,element)" [disabled]="!puedeCapturar ">
                              <mat-icon>delete</mat-icon>
                            </button>
                          </span>
                          &nbsp;&nbsp;
                        </td>
                      </ng-container>

                      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                    </table>

                  </div>
                </div>
              </td>
            </ng-container>


            <tr mat-header-row *matHeaderRowDef="[ 'estatus','componente',
                  'elementoEvaluacion',
                  'indicator',
                  'nivelmodalidad',
                  'normativa',
                  'nombreevidencia',
                  'subirevidencia'
                  ]"></tr>
            <tr mat-row *matRowDef="let element; columns: ['estatus','componente',
                  'elementoEvaluacion',
                  'indicator',
                  'nivelmodalidad',
                  'normativa',
                  'nombreevidencia',
                  'subirevidencia']" [class.example-element-row]="element.evidenciasArchivos?.length"
              [class.example-expanded-row]="expandedElement === element" (click)="toggleRow($event, element)"></tr>

            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
          </table>

          <ng-template [ngIf]="listEvidenciasIndicadorCaptura.length === 0">
            <p class="empty-table mt-4">No hay datos para mostrar</p>
          </ng-template>
        </div>
      </div>
    </mat-dialog-content>
    <mat-dialog-actions align="center" class="pb-4" hidden="true">
      <button type="button" mat-raised-button class="mt-3" (click)="onAdd()" color="primary">Guardar</button>
      <button type="button" mat-raised-button class="mt-3" (click)="onClose()">Cancelar</button>
    </mat-dialog-actions>
  </div>
</div>